Progressive training for task 1
100%|██████████| 79/79 [01:19<00:00,  1.01s/it]
Task 1, Epoch 1/2 => Loss 2.472, Train_accy 23.26, Test_accy 12.60
100%|██████████| 79/79 [01:19<00:00,  1.01s/it]
Task 1, Epoch 2/2 => Loss 2.282, Train_accy 24.26, Test_accy 12.85
Cache size: 79
Task 1, Epoch 2/2 => Loss 2.282, Train_accy 24.26, Test_accy 12.85
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.81it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 10 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.83it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 11 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.82it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 12 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.83it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 13 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.82it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 14 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.82it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 15 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.80it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 16 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.83it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 17 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.82it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 18 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.82it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 19 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  0%|          | 0/50 [00:00<?, ?it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.25it/s]
best_loss: 0.19820658230781554
Computing class relations...
Old means shape: (10, 768)
New means shape: (10, 768)
Class relations: [12 12 12 12 12 12 12 12 12 12]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 10000
Feature dataset dimension: 768
Label dataset size: 10000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 20])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 157/157 [00:05<00:00, 27.27batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 1 Elapsed time:  309.84549856185913
Average Accuracy (CNN): 51.725
Learning on 20-30
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([20, 768])
New weight (Cosine FC) torch.Size([30, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=30, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([20, 5000])
New weight (AC model) torch.Size([30, 5000])
118,883,185 total parameters.
29,094,529 training parameters.
Progressive training for task 2
100%|██████████| 79/79 [01:21<00:00,  1.04s/it]
Task 2, Epoch 1/2 => Loss 2.938, Train_accy 19.34, Test_accy 6.30
100%|██████████| 79/79 [01:21<00:00,  1.03s/it]
Task 2, Epoch 2/2 => Loss 2.887, Train_accy 20.00, Test_accy 6.60
Cache size: 79
Task 2, Epoch 2/2 => Loss 2.887, Train_accy 20.00, Test_accy 6.60
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.74it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 20 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.75it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 21 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.75it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 22 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.74it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 23 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.75it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 24 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.74it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 25 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.75it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 26 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.75it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 27 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.76it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 28 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.75it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 29 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.35it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.40it/s]
best_loss: 0.14121297669410707
Computing class relations...
Old means shape: (20, 768)
New means shape: (10, 768)
Class relations: [28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 15000
Feature dataset dimension: 768
Label dataset size: 15000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 30])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 235/235 [00:08<00:00, 27.26batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 2 Elapsed time:  346.12227869033813
Average Accuracy (CNN): 40.70666666666667
Learning on 30-40
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([30, 768])
New weight (Cosine FC) torch.Size([40, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=40, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([30, 5000])
New weight (AC model) torch.Size([40, 5000])
118,940,865 total parameters.
29,102,209 training parameters.
Progressive training for task 3
100%|██████████| 79/79 [01:23<00:00,  1.06s/it]
Task 3, Epoch 1/2 => Loss 2.624, Train_accy 28.68, Test_accy 8.20
100%|██████████| 79/79 [01:23<00:00,  1.06s/it]
Task 3, Epoch 2/2 => Loss 2.422, Train_accy 30.16, Test_accy 8.15
Cache size: 79
Task 3, Epoch 2/2 => Loss 2.422, Train_accy 30.16, Test_accy 8.15
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.68it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 30 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.68it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 31 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.67it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 32 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.68it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 33 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.68it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 34 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.68it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 35 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.66it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 36 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.65it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 37 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.68it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 38 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.67it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 39 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.32it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.33it/s]
best_loss: 0.09780219918489456
Computing class relations...
Old means shape: (30, 768)
New means shape: (10, 768)
Class relations: [31 31 31 31 33 33 31 31 31 33 33 33 33 31 32 33 33 33 31 32 37 39 39 39
 39 37 37 39 37 37]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 20000
Feature dataset dimension: 768
Label dataset size: 20000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 40])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 313/313 [00:11<00:00, 27.14batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 3 Elapsed time:  386.5521318912506
Average Accuracy (CNN): 34.225
Learning on 40-50
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([40, 768])
New weight (Cosine FC) torch.Size([50, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=50, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([40, 5000])
New weight (AC model) torch.Size([50, 5000])
118,998,545 total parameters.
29,109,889 training parameters.
Progressive training for task 4
100%|██████████| 79/79 [01:26<00:00,  1.09s/it]
Task 4, Epoch 1/2 => Loss 2.447, Train_accy 34.30, Test_accy 7.50
100%|██████████| 79/79 [01:26<00:00,  1.09s/it]
Task 4, Epoch 2/2 => Loss 2.305, Train_accy 34.96, Test_accy 7.56
Cache size: 79
Task 4, Epoch 2/2 => Loss 2.305, Train_accy 34.96, Test_accy 7.56
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.62it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 40 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.62it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 41 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.62it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 42 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.61it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 43 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.62it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 44 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.60it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 45 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.61it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 46 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.61it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 47 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.61it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 48 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:04<00:00,  1.61it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 49 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.10it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.37it/s]
best_loss: 0.08803850156068802
Computing class relations...
Old means shape: (40, 768)
New means shape: (10, 768)
Class relations: [44 40 44 40 44 44 44 44 44 44 40 40 40 40 40 40 40 40 40 40 40 40 40 40
 40 40 40 40 40 40 40 40 40 40 40 46 40 40 40 40]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 25000
Feature dataset dimension: 768
Label dataset size: 25000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 50])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 391/391 [00:14<00:00, 27.13batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 4 Elapsed time:  427.4806854724884
Average Accuracy (CNN): 29.804000000000002
Learning on 50-60
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([50, 768])
New weight (Cosine FC) torch.Size([60, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=60, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([50, 5000])
New weight (AC model) torch.Size([60, 5000])
119,056,225 total parameters.
29,117,569 training parameters.
Progressive training for task 5
100%|██████████| 79/79 [01:28<00:00,  1.12s/it]
Task 5, Epoch 1/2 => Loss 2.493, Train_accy 22.96, Test_accy 4.02
100%|██████████| 79/79 [01:28<00:00,  1.12s/it]
Task 5, Epoch 2/2 => Loss 2.359, Train_accy 23.54, Test_accy 4.03
Cache size: 79
Task 5, Epoch 2/2 => Loss 2.359, Train_accy 23.54, Test_accy 4.03
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.53it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 50 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.53it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 51 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.53it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 52 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.52it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 53 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.52it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 54 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.53it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 55 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.54it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 56 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.52it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 57 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.54it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 58 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.54it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 59 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.28it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.29it/s]
best_loss: 0.08449347710609437
Computing class relations...
Old means shape: (50, 768)
New means shape: (10, 768)
Class relations: [51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51
 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 53 50 50 50 53 50 50 50
 53 50]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 30000
Feature dataset dimension: 768
Label dataset size: 30000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49 50 51 52 53 54 55 56 57 58 59]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 60])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 469/469 [00:17<00:00, 27.01batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 5 Elapsed time:  473.27457547187805
Average Accuracy (CNN): 26.475000000000005
Learning on 60-70
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([60, 768])
New weight (Cosine FC) torch.Size([70, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=70, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([60, 5000])
New weight (AC model) torch.Size([70, 5000])
119,113,905 total parameters.
29,125,249 training parameters.
Progressive training for task 6
100%|██████████| 79/79 [01:30<00:00,  1.14s/it]
Task 6, Epoch 1/2 => Loss 2.457, Train_accy 23.08, Test_accy 3.53
100%|██████████| 79/79 [01:30<00:00,  1.14s/it]
Task 6, Epoch 2/2 => Loss 2.337, Train_accy 23.38, Test_accy 3.49
Cache size: 79
Task 6, Epoch 2/2 => Loss 2.337, Train_accy 23.38, Test_accy 3.49
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.49it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 60 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.49it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 61 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.50it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 62 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.48it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 63 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.48it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 64 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.49it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 65 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.50it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 66 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.49it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 67 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.50it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 68 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.50it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 69 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.04it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.47it/s]
best_loss: 0.066816171169281
Computing class relations...
Old means shape: (60, 768)
New means shape: (10, 768)
Class relations: [68 68 65 68 68 68 68 65 65 68 68 68 68 68 68 68 68 68 68 68 68 68 68 68
 68 68 68 68 68 68 68 68 68 68 68 69 68 68 68 68 68 69 69 69 69 64 69 69
 69 69 68 68 64 68 68 68 67 68 68 68]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 35000
Feature dataset dimension: 768
Label dataset size: 35000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 70])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 547/547 [00:20<00:00, 27.24batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 6 Elapsed time:  514.9593975543976
Average Accuracy (CNN): 23.572857142857146
Learning on 70-80
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([70, 768])
New weight (Cosine FC) torch.Size([80, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=80, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([70, 5000])
New weight (AC model) torch.Size([80, 5000])
119,171,585 total parameters.
29,132,929 training parameters.
Progressive training for task 7
100%|██████████| 79/79 [01:32<00:00,  1.17s/it]
Task 7, Epoch 1/2 => Loss 2.444, Train_accy 24.52, Test_accy 3.85
100%|██████████| 79/79 [01:32<00:00,  1.17s/it]
Task 7, Epoch 2/2 => Loss 2.305, Train_accy 24.90, Test_accy 3.81
Cache size: 79
Task 7, Epoch 2/2 => Loss 2.305, Train_accy 24.90, Test_accy 3.81
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.46it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 70 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.44it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 71 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.45it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 72 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.45it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 73 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.46it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 74 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.45it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 75 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.45it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 76 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.46it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 77 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.46it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 78 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.46it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 79 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.13it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.44it/s]
best_loss: 0.054034317135810854
Computing class relations...
Old means shape: (70, 768)
New means shape: (10, 768)
Class relations: [76 76 76 76 76 76 76 76 76 76 74 74 74 73 73 74 74 74 73 73 77 75 77 77
 77 77 77 77 77 77 74 77 74 74 74 73 75 74 74 75 74 74 73 73 74 74 73 73
 73 73 79 77 74 74 77 77 77 74 77 74 73 77 79 73 73 79 77 79 74 73]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 40000
Feature dataset dimension: 768
Label dataset size: 40000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71
 72 73 74 75 76 77 78 79]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 80])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 625/625 [00:22<00:00, 27.23batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 7 Elapsed time:  561.6775250434875
Average Accuracy (CNN): 21.37
Learning on 80-90
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([80, 768])
New weight (Cosine FC) torch.Size([90, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=90, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([80, 5000])
New weight (AC model) torch.Size([90, 5000])
119,229,265 total parameters.
29,140,609 training parameters.
Progressive training for task 8
100%|██████████| 79/79 [01:35<00:00,  1.20s/it]
Task 8, Epoch 1/2 => Loss 2.496, Train_accy 22.62, Test_accy 2.59
100%|██████████| 79/79 [01:34<00:00,  1.20s/it]
Task 8, Epoch 2/2 => Loss 2.350, Train_accy 24.24, Test_accy 2.64
Cache size: 79
Task 8, Epoch 2/2 => Loss 2.350, Train_accy 24.24, Test_accy 2.64
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 80 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.41it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 81 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 82 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 83 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.41it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 84 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 85 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 86 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 87 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 88 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.42it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 89 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.06it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.44it/s]
best_loss: 0.05010869991779327
Computing class relations...
Old means shape: (80, 768)
New means shape: (10, 768)
Class relations: [87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87
 87 87 87 87 87 87 87 84 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87 87
 87 87 87 88 87 87 88 88 88 85 88 87 87 87 87 87 87 87 87 87 87 87 80 87
 87 87 87 87 80 84 86 80]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 45000
Feature dataset dimension: 768
Label dataset size: 45000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71
 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 90])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 704/704 [00:25<00:00, 27.28batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 8 Elapsed time:  611.5443787574768
Average Accuracy (CNN): 19.531111111111112
Learning on 90-100
Train dataset size: 5000
Use Cosine model as classifier head.
Cosine model architecture: CosineLinear2()
Old weight (Cosine FC) torch.Size([90, 768])
New weight (Cosine FC) torch.Size([100, 768])
Use AC model as classifier head.
AC model architecture: AC_Linear(
  (fc): Sequential(
    (0): Linear(in_features=768, out_features=5000, bias=False)
    (1): ReLU()
    (2): Linear(in_features=5000, out_features=100, bias=False)
  )
)
Hidden weight (AC model) torch.Size([5000, 768])
Old weight (AC model) torch.Size([90, 5000])
New weight (AC model) torch.Size([100, 5000])
119,286,945 total parameters.
29,148,289 training parameters.
Progressive training for task 9
100%|██████████| 79/79 [01:36<00:00,  1.22s/it]
Task 9, Epoch 1/2 => Loss 2.268, Train_accy 36.62, Test_accy 3.47
100%|██████████| 79/79 [01:36<00:00,  1.23s/it]
Task 9, Epoch 2/2 => Loss 2.081, Train_accy 35.60, Test_accy 3.53
Cache size: 79
Task 9, Epoch 2/2 => Loss 2.081, Train_accy 35.60, Test_accy 3.53
Computing class means and covariance matrices...
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.37it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 90 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.38it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 91 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.38it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 92 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.38it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 93 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.37it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 94 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.37it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 95 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.37it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 96 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.38it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 97 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.38it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 98 covariance matrix shape: (768, 768)
Extracting prototypes...
100%|██████████| 8/8 [00:05<00:00,  1.38it/s]
Extracted vectors shape: (500, 768) float32
Extracted targets shape: (500,) int64
Class 99 covariance matrix shape: (768, 768)
Generating pseudo-features for old classes from relations...
Calibrating prototype model (Prototype correction - Knowledge Rumination)...
  2%|▏         | 1/50 [00:00<00:09,  5.40it/s]
开始 修正 prototype
100%|██████████| 50/50 [00:09<00:00,  5.54it/s]
best_loss: 0.06650272673368454
Computing class relations...
Old means shape: (90, 768)
New means shape: (10, 768)
Class relations: [98 99 98 98 98 91 98 91 91 98 99 98 99 99 99 99 99 99 99 99 98 98 98 98
 98 98 98 98 98 98 98 98 98 98 98 90 98 98 98 96 99 92 92 99 92 99 99 92
 99 99 90 98 90 90 98 98 98 90 98 99 99 99 99 99 99 99 99 99 99 99 97 94
 90 92 90 90 97 98 92 97 90 92 90 90 90 90 92 99 90 98]
Building feature dataset...
Extract prototypes for known classes...
Total feature dataset size: 50000
Feature dataset dimension: 768
Label dataset size: 50000
Label dataset classes: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71
 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95
 96 97 98 99]
Incremental class alignment (Knowledge Memorization)...
Knowledge Memorization completed.
Updated weight matrix W shape: torch.Size([5000, 100])
Updated correlation matrix R shape: torch.Size([5000, 5000])
numpy inverse
Calibrating classifier weights (Knowledge Rumination - Selective reinforcement of old task knowledge)...
Alignment: 100%|██████████| 782/782 [00:28<00:00, 27.28batch/s]
numpy inverse
Finish one task 

[TIME TIME TIME] Task= 9 Elapsed time:  660.3901603221893
Average Accuracy (CNN): 18.166999999999998